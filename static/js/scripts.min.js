var canVote,messageIsVisible=!1,showMessage=function(s,e){if($(".wrapper").animate({scrollTop:0},200),!messageIsVisible){messageIsVisible=!0,$(".message").toggleClass(s),$(".message h4").text(e),$(".message").toggleClass("show");setTimeout(function(){$(".message").toggleClass("show"),$(".message").toggleClass(s),$(".message h4").text(""),messageIsVisible=!1},2e3)}};function checkCookie(){canVote=!document.cookie||-1==document.cookie.indexOf("PD_poll_9559362")}checkCookie();function onClickVote(s,e){if(stats.selectedSeason().isLatest||"total"===stats.selectedSeason().id)if(canVote){canVote=!1;var t=$(e.srcElement).closest(".container").data("player"),a="subban"===t,o=a?"weber":"subban",n=a?"P.K. Subban":"Shea Weber";a?$("#PDI_answer43654459").prop("checked",!0):$("#PDI_answer43654460").prop("checked",!0),PD_prevote9559362(1);var l=stats.seasons[0][t].votes(),i=stats.seasons[0][o].votes(),r=a?mapPollToObject(l.votes+1,i.votes,0,0):mapPollToObject(i.votes,l.votes+1,0,0);stats.seasons[0][t].votes(r[t].votes),stats.seasons[0][o].votes(r[o].votes);var p=stats.seasons.length-1,u=stats.seasons[p][t].votes(),c=stats.seasons[p][o].votes(),b=a?mapPollToObject(u.votes+1,c.votes,0,0):mapPollToObject(c.votes,u.votes+1,0,0);stats.seasons[p][t].votes(b[t].votes),stats.seasons[p][o].votes(b[o].votes),showMessage("success","+1 vote for "+n)}else showMessage("error","Sorry, you've already voted");else showMessage("error","Voting has ended for "+stats.selectedSeason().name)}var commentClickable=!0;$(".trigger-comments").click(function(){var s=$(this);if(commentClickable){if(commentClickable=!1,s.is("#close-comments")){setTimeout(function(){$("#page-1").addClass("hidden")},500)}else $("#page-1").removeClass("hidden");$("#page-1").toggleClass("slide-in"),$("#page-1").toggleClass("slide-out"),commentClickable=!0}});function StatsModel(){this.seasons=[{id:"p2017",name:"PLAYOFFS 2017",isLatest:!1,isPlayoff:!0,subban:{stats:{played:22,goals:2,assists:10,points:12,plusMinus:5},team:{wins:14,losses:8,otLosses:"",points:"",status:"CUP FINAL"},votes:{votes:12271,percent:64}},weber:{stats:{played:6,goals:1,assists:2,points:3,plusMinus:1},team:{wins:2,losses:4,otLosses:"",points:"",status:"1ST RND"},votes:{votes:6870,percent:36}}},{id:"r2016",name:"REG. SEASON 2016-2017",isLatest:!1,isPlayoff:!1,subban:{stats:{played:66,goals:10,assists:30,points:40,plusMinus:-8},team:{wins:41,losses:29,otLosses:12,points:94,status:""},votes:{votes:11433,percent:20}},weber:{stats:{played:78,goals:17,assists:25,points:42,plusMinus:20},team:{wins:47,losses:26,otLosses:9,points:103,status:""},votes:{votes:45061,percent:80}}}],this.isDataLoaded=ko.observable(!1),this.selectedSeason=ko.observable()}var stats=new StatsModel,DATA_URL_SUBBAN_REGULAR="https://statsapi.web.nhl.com/api/v1/people/8474056?expand=person.stats&stats=yearByYear&site=en_nhlCA",DATA_URL_WEBER_REGULAR=DATA_URL_SUBBAN_REGULAR.replace("8474056","8470642"),DATA_URL_SUBBAN_PLAYOFF="https://statsapi.web.nhl.com/api/v1/people/8474056/stats?stats=yearByYearPlayoffs&site=en_nhlCA",DATA_URL_WEBER_PLAYOFF=DATA_URL_SUBBAN_PLAYOFF.replace("8474056","8470642"),DATA_URL_LEAGUE="https://statsapi.web.nhl.com/api/v1/standings?expand=standings.record,standings.team&season=20172018",DATA_URL_POLL="/poll",STATS_OFFSET={SUBBAN:{played:88,goals:12,assists:40,points:52,plusMinus:-3},WEBER:{played:84,goals:18,assists:27,points:45,plusMinus:21}},POLL_OFFSET={SUBBAN:23704,WEBER:51931};$.when(fetch(DATA_URL_SUBBAN_REGULAR),fetch(DATA_URL_WEBER_REGULAR),fetch(DATA_URL_LEAGUE),fetch(DATA_URL_POLL)).done(function(s,e,t,a){var o=a[0].demand[0].result.answers.answer,n=o[0].total,l=o[1].total,i=mapPollToObject(n,l,POLL_OFFSET.SUBBAN,POLL_OFFSET.WEBER),r=mapPollToObject(n,l,0,0),p={id:"r2018",name:"REG. SEASON 2017-2018",isLatest:!0,isPlayoff:!1,subban:{stats:mapPlayerDataToArray(s),team:mapLeagueRegDataToArray(t,2,18),votes:ko.observable(i.subban.votes)},weber:{stats:mapPlayerDataToArray(e),team:mapLeagueRegDataToArray(t,1,8),votes:ko.observable(i.weber.votes)}},u={id:"total",name:"TOTALS SINCE TRADE",isLatest:!1,isPlayoff:!1,subban:{stats:{played:p.subban.stats.played+STATS_OFFSET.SUBBAN.played,goals:p.subban.stats.goals+STATS_OFFSET.SUBBAN.goals,assists:p.subban.stats.assists+STATS_OFFSET.SUBBAN.assists,points:p.subban.stats.points+STATS_OFFSET.SUBBAN.points,plusMinus:p.subban.stats.plusMinus+STATS_OFFSET.SUBBAN.plusMinus},team:{},votes:ko.observable(r.subban.votes)},weber:{stats:{played:p.weber.stats.played+STATS_OFFSET.WEBER.played,goals:p.weber.stats.goals+STATS_OFFSET.WEBER.goals,assists:p.weber.stats.assists+STATS_OFFSET.WEBER.assists,points:p.weber.stats.points+STATS_OFFSET.WEBER.points,plusMinus:p.weber.stats.plusMinus+STATS_OFFSET.WEBER.plusMinus},team:{},votes:ko.observable(r.weber.votes)}};stats.seasons.unshift(p),stats.seasons.push(u),ko.applyBindings(stats),stats.isDataLoaded(!0)});function fetch(s){return $.ajax({type:"GET",url:s,dataType:"json"})}function mapPlayerDataToArray(s){for(var e=s[0].people[0].stats[0].splits,t=e.length-1,a=e[t];"National Hockey League"!==a.league.name;)a=e[t-1],t--;return{played:(a=a.stat).games,goals:a.goals,assists:a.assists,points:a.points,plusMinus:a.plusMinus}}function mapLeagueRegDataToArray(s,e,t){var a=s[0].records[e].teamRecords.filter(function(s){return s.team.id===t})[0],o=a.leagueRecord;return{wins:o.wins,losses:o.losses,otLosses:o.ot,points:a.points,status:""}}function mapPollToObject(s,e,t,a){var o=s-t,n=e-a,l=o/(o+n)*100;return{subban:{votes:{votes:o,percent:l=Math.round(l.toFixed(2))}},weber:{votes:{votes:n,percent:100-l}}}}